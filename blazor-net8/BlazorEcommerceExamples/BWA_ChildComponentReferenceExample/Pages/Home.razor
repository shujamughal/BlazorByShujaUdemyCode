@page "/"

@using Models
@using BWA_ChildComponentReferenceExample.Components

<h3>Product List</h3>

<div class="row">
    @foreach (var product in Products)
    {
        <div class="col-md-4 mb-4">
            <!-- Correct @ref directive -->
            <ProductCard @ref="productCardRefs[Products.IndexOf(product)]" Product="product" OnAddToCart="HandleAddToCart" />
        </div>
    }
</div>

<button class="btn btn-success mt-4" @onclick="HighlightAllCards">Highlight All Cards</button>

<button class="btn btn-warning mt-4" @onclick="HighlightCartCards">Highlight Products in Cart</button>

<button class="btn btn-danger mt-4" @onclick="RemoveAllHighlights">Remove All Highlights</button>


<h3>Shopping Cart</h3>
@if (ShoppingCart.Count == 0)
{
    <p>No items in the cart.</p>
}
else
{
    <ul>
        @foreach (var product in ShoppingCart)
        {
            <li>@product.Name - @product.Price.ToString("C")</li>
        }
    </ul>
}

@code {
    private List<Product> Products { get; set; }
    private List<Product> ShoppingCart { get; set; } = new List<Product>();

    // List to capture all ProductCard component references
    private ProductCard[] productCardRefs;

    protected override void OnInitialized()
    {
        // Sample product data
        Products = new List<Product>
        {
            new Product { Name = "Product 1", Description = "This is product 1", Price = 10.99m, ImageUrl = "https://via.placeholder.com/150" },
            new Product { Name = "Product 2", Description = "This is product 2", Price = 20.99m, ImageUrl = "https://via.placeholder.com/150" },
            new Product { Name = "Product 3", Description = "This is product 3", Price = 30.99m, ImageUrl = "https://via.placeholder.com/150" }
        };

        // Initialize array for ProductCard references
        productCardRefs = new ProductCard[Products.Count];
    }

    private void HandleAddToCart(Product product)
    {
        ShoppingCart.Add(product);
    }

    // Method to highlight all product cards by calling the method in each child component
    private void HighlightAllCards()
    {
        foreach (var card in productCardRefs)
        {
            card?.HighlightCard(); // Ensure card reference exists before calling
        }
    }
    // Method to highlight product cards that are in the shopping cart
    private void HighlightCartCards()
    {
        foreach (var product in ShoppingCart)
        {
            int index = Products.IndexOf(product);
            if (index >= 0) // Ensure the product exists in the Products list
            {
                productCardRefs[index]?.HighlightCard(); // Call HighlightCard only on products in the cart
            }
        }
    }
    // Method to remove all highlights from product cards
    private void RemoveAllHighlights()
    {
        foreach (var productCard in productCardRefs)
        {
            productCard?.RemoveHighlight(); // Call RemoveHighlight for each ProductCard
        }
    }
}
